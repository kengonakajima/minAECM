# AECM版の echobackと cancel_file の実装

本プロジェクトでは、音響エコーキャンセラの実装である AECM を用いた、
エコーキャンセルつきエコーバックプログラム echoback と、
refとrecの2つのWAVファイルを入力してエコー信号をキャンセルするプログラム cancel_file を実装する。

この2つのプログラムは、もともと  ../minAEC  で実装されたものを、コピーしてきたが、まだビルドと実行ができていない。

../minAEC は、WebRTCの最新のエコーキャンセラである AEC3 を大幅に縮小したものを使っている。

しかし本プロジェクトでは、AEC3ではなく、WebRTCの、軽量なエコーキャンセラ実装である、 AECM を用いて、
minAEC と同じように、 echobackと cancel_file を実装する。

minAECの仕様は、 ../minAEC/spec.txt に記述されている。


## 実装の方針

本プロジェクトの目的はエコーキャンセルアルゴリズムの実装をするためなので、
できるだけ、必要不可欠なアルゴリズムそのもの以外の要素を排除したい。
それらはつまり、以下のようなものである:

ボイラープレートや、多プラットフォーム対応、拡張性、柔軟性、
セキュリティ、エラー処理、例外処理、高負荷対策、最高性能の追求、国際化、
再利用性などは一切必要がない。
複数のサンプリング周波数に対応する必要はない。
古いC++(17とか)に対応する必要はない。
macOSだけで動けば良い。
メモリ消費が多くても良い。
実行が遅くても良い。
Apple Siliconの macOS専用でよい。それいがいには一切対応しなくていい。
macOSのバージョンは手元のmacbookだけでいい。

音質は、キャンセルができていれば、多少低くて構わない。ただしフィルタは収束して、エコーキャンセルが実際に機能している必要はある。

エコーキャンセルがいったいどのような技術によって支えられているのかの説明ができればよく、それ以外は必要がない。
モノラルで十分、16KHz固定でOK,マルチチャネル不要、
拡張性不要、柔軟性不要。
教育目的に必要ない機能自体を削除し、結果としてコード量を削減する。

型を固定することでテンプレートの利用も削減したい。
テンプレートはエコーキャンセルの仕組みを説明するためには不要。
デバッグ用の機能も不要。

安全性のための機能も不要。
とにかくエコーキャンセルの根本的な仕組みを解説するため以外のコード部分は一切不要。
ソースを1行でも減らす。


## 残したいところ
以下の部分は残したい。

自走できるエコーキャンセラを実装したいので、
また、PortAudioを用いて実際に動かして試せることも必須。
それ以外の要素はすべて必要がない。
ライブラリとして利用する必要がないので、いろいろなオブジェクトを複数生成したり破棄したりする必要もない。
サンプルは一度動けば良い。
複数スレッドに対応する必要もない。

## 作業内容

Makefileを修正し、 make一発で echobackと cancel_fileがコンパイルされること。

それを私が実行して、実際に耳で音を聞いて音質を確認します。



## さらなるコード削減に向けて

エコー除去のアルゴリズムを説明するためのコード以外は一切なくしたい。
そのために、 aecmや common_audioなどのライブラリ本体のコードをどんどん小さくしていきたい。


- 複数チャンネルを処理するための機能をすべて削減したい。
- 拡張性や柔軟性や安全性のためのC++機能の活用が不要。たとえば、 scoped_refptr など。
- common_audio/mocks いる?
- vad いらない
- .gnとかいらない
